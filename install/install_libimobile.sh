#!/bin/bash


echo "This script installs the libimobile, tcprelay and ideviceinstaller on Kali 2"
echo "Connect to the device:"
echo "   ./tcprelay.sh 22:2222"
echo "   ssh -p 2222 root@localhost"
echo "Install an ipa file:"
echo "   ideviceinstaller -i <IPA file name>"

# Install libimobile prerequisites
apt-get install libtool automake libimobiledevice-utils \
        libplist-dev libplist++-dev libusbmuxd-dev libssl-dev

# Download libimobile from git
git clone https://github.com/libimobiledevice/libimobiledevice.git

# Compile and install libimobile
cd libimobiledevice
./autogen.sh
make
make install
cd ..


# Download tcprelay.py and move to /usr/local/bin
wget https://raw.githubusercontent.com/TestStudio/usbmuxd/master/python-client/tcprelay.py
wget https://raw.githubusercontent.com/TestStudio/usbmuxd/master/python-client/usbmux.py
chmod +x tcprelay.py
chmod +x usbmux.py
mv tcprelay.py /usr/local/bin
mv usbmux.py /usr/local/bin

# Install ideviceinstaller prerequisites
apt-get install libzip-dev

# Download ideviceinstaller
git clone https://github.com/libimobiledevice/ideviceinstaller.git

# Compile and install ideviceinstaller
cd ideviceinstaller
./autogen.sh
make
make install
cd..
